angular.module("angularCharts",["angularChartsTemplates"]),angular.module("angularCharts").directive("acChart",["$templateCache","$compile","$window","$timeout",function(a,b,c,d){function e(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.round(15*Math.random())];return b}function f(f,h){function i(){l(),j(),k();var a=m(I);a(),y(),J.onload()}function j(){if(!J.legend.display)return E=L,void(F=K);switch(J.legend.position){case"top":case"bottom":E=.75*L,F=K;break;case"left":case"right":E=L,F=.75*K}}function k(){var c=a.get(J.legend.position);h.html(b(c)(f)),G=h.find(".ac-chart"),H=h.find(".ac-legend"),E-=h.find(".ac-title").height()}function l(){B=f.acData,I=f.acChart,C=B?B.series||[]:[],D=B?B.data||[]:[],f.acConfig&&(angular.extend(J,f.acConfig),J.colors=J.colors.concat(M))}function m(a){var b={pie:t,bar:o,line:r,area:s,point:u,hBar:p,sBar:q};return b[a]}function n(a,b){var c=b.domain();if(J.xAxisMaxTicks&&c.length>J.xAxisMaxTicks){var d=Math.ceil(c.length/J.xAxisMaxTicks);a.tickValues(c.filter(function(a,b){return b%d==0}))}}function o(){var a={top:0,right:20,bottom:30,left:40};F-=a.left+a.right,E-=a.top+a.bottom;var b=d3.scale.ordinal().rangeRoundBands([0,F],.1),c=d3.scale.linear().range([E,10]),d=d3.scale.ordinal().rangeRoundBands([0,F],.1),e=[0];D.forEach(function(a){a.nicedata=a.y.map(function(b,c){return e.push(b),{x:a.x,y:b,s:c,tooltip:angular.isArray(a.tooltip)?a.tooltip[c]:a.tooltip}})});var g=d3.max(D.map(function(a){return a.y.length}));f.yMaxData=g,b.domain(D.map(function(a){return a.x}));var h=.2*d3.max(e);c.domain([d3.min(e),d3.max(e)+h]),d.domain(d3.range(g)).rangeRoundBands([0,b.rangeBand()]);var i=d3.svg.axis().scale(b).orient("bottom");n(i,b);var j=d3.svg.axis().scale(c).orient("left").ticks(10).tickFormat(d3.format("s")),k=d3.select(G[0]).append("svg").attr("width",F+a.left+a.right).attr("height",E+a.top+a.bottom),l=k.append("g").attr("transform","translate("+a.left+","+a.top+")");l.append("g").attr("class","x axis").attr("transform","translate(0,"+E+")").call(i),l.append("g").attr("class","y axis").call(j);var m=l.selectAll(".state").data(D).enter().append("g").attr("class","g").attr("x",function(a){return b(a.x)}).attr("transform",function(a){return"translate("+b(a.x)+",0)"}),o=m.selectAll("rect").data(function(a){return a.nicedata}).enter().append("rect");o.attr("width",d.rangeBand()),o.attr("x",function(a,b){return d(b)}).attr("y",E).attr("height",0).attr("class",function(a){return A(a.s)}).transition().ease("cubic-in-out").duration(1e3).attr("y",function(a){return c(Math.max(0,a.y))}).attr("height",function(a){return Math.abs(c(a.y)-c(0))});var p=d3.svg.brush().x(b).on("brushend",function(){if(d3.event.sourceEvent){var a=p.extent(),c=b.range(),d=[Math.max(a[0],c[0]),a[1]],e=[],f=0,g=a[1];c.forEach(function(b){a[0]>f&&a[0]<b&&(d[0]=f),a[1]>f&&a[1]<b&&(g=f,d[1]=b),f=b}),a[1]>c[c.length-1]&&(g=c[c.length-1],d[1]=c[c.length-1]+b.rangeBand()),e.push(k.select('g[x="'+d[0]+'"]').data()[0]),e.push(k.select('g[x="'+g+'"]').data()[0]),d3.select(this).transition().call(p.extent(d)).call(p.event),J.brush(e,d3.event)}});l.append("g").attr("class","brush").call(p).selectAll("rect").attr("height",E-2),o.on("mouseover",function(a){v({value:a.y,series:C[a.s],index:a.x},d3.event),J.mouseover(a,d3.event),f.$apply()}).on("mouseleave",function(a){w(),J.mouseout(a,d3.event),f.$apply()}).on("mousemove",function(){x(d3.event)}).on("click",function(a){J.click.call(a,d3.event),f.$apply()}),J.labels&&m.selectAll("not-a-class").data(function(a){return a.nicedata}).enter().append("text").attr("x",function(a,b){return d(b)}).attr("y",function(a){return E-Math.abs(c(a.y)-c(0))}).text(function(a){return a.y}),k.append("line").attr("x1",F).attr("y1",c(0)).attr("y2",c(0)).style("stroke","silver")}function p(){var a={top:0,right:20,bottom:0,left:40};F-=a.left+a.right,E-=a.top+a.bottom;var b=d3.scale.ordinal().rangeRoundBands([0,E],.1),c=d3.scale.linear().range([F,10]),d=d3.scale.ordinal().rangeRoundBands([0,E],.1),e=[0];D.forEach(function(a){a.nicedata=a.x.map(function(b,c){return e.push(b),{x:b,y:a.y,s:c}})});var g=d3.max(D.map(function(a){return a.x.length}));f.xMaxData=g,b.domain(D.map(function(a){return a.y}));var h=.2*d3.max(e);c.domain([d3.min(e),d3.max(e)+h]),d.domain(d3.range(g)).rangeRoundBands([0,b.rangeBand()]);var i=d3.svg.axis().scale(b).orient("left"),j=d3.select(G[0]).append("svg").attr("width",F+a.left+a.right).attr("height",E+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");j.append("g").attr("class","y axis").call(i);var k=j.selectAll(".state").data(D).enter().append("g").attr("class","g").attr("transform",function(a){return"translate(0, "+b(a.y)+")"}),l=k.selectAll("rect").data(function(a){return a.nicedata}).enter().append("rect");l.attr("height",d.rangeBand()),l.attr("y",function(a,b){return d(b)}).attr("x",0).attr("width",0).attr("class",function(a){return A(a.s)}).transition().ease("cubic-in-out").duration(1e3).attr("width",function(a){return Math.abs(c(a.x)-c(0))});var m=k.selectAll("text").data(function(a){return a.nicedata}).enter().append("text");m.attr("y",function(){return d.rangeBand()/2}).attr("dy",".36em").attr("x",0).transition().ease("cubic-in-out").duration(1e3).attr("x",function(a){return Math.abs(c(0)-c(a.x))}).attr("dx",function(){return"0.32em"}).text(function(a){return a.x}),l.on("mouseover",function(a){J.mouseover(a,d3.event),f.$apply()}).on("mouseleave",function(a){J.mouseout(a,d3.event),f.$apply()}).on("mousemove",function(){x(d3.event)}).on("click",function(a){J.click.call(a,d3.event),f.$apply()})}function q(){var a={top:0,right:20,bottom:30,left:40};F-=a.left+a.right,E-=a.top+a.bottom;var b=d3.scale.ordinal().rangeRoundBands([0,F],.1),c=d3.scale.linear().range([E,10]),d=[0];D.forEach(function(a){var b=0;a.nicedata=a.y.map(function(c,d){var e={x:a.x,y:c,y0:b,s:d,tooltip:angular.isArray(a.tooltip)?a.tooltip[d]:a.tooltip};return b+=c,e}),d.push(b)});var e=d3.max(D.map(function(a){return a.y.length}));f.yMaxData=e,b.domain(D.map(function(a){return a.x}));var g=.2*d3.max(d);c.domain([d3.min(d),d3.max(d)+g]);var h=d3.svg.axis().scale(b).orient("bottom");n(h,b);var i=d3.svg.axis().scale(c).orient("left").ticks(10).tickFormat(d3.format("s")),j=d3.select(G[0]).append("svg").attr("width",F+a.left+a.right).attr("height",E+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");j.append("g").attr("class","x axis").attr("transform","translate(0,"+E+")").call(h),j.append("g").attr("class","y axis").call(i);var k=j.selectAll(".state").data(D).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+b(a.x)+",0)"}),l=k.selectAll("rect").data(function(a){return a.nicedata}).enter().append("rect");l.attr("width",b.rangeBand()),l.attr("x",function(a,c){return b(c)}).attr("y",E).attr("height",0).attr("class",function(a){return A(a.s)}).transition().ease("cubic-in-out").duration(1e3).attr("y",function(a){return c(Math.max(0,a.y+a.y0))}).attr("height",function(a){return Math.abs(c(a.y)-c(0))}),l.on("mouseover",function(a){v({value:a.y,series:C[a.s],index:a.x},d3.event),J.mouseover(a,d3.event),f.$apply()}).on("mouseleave",function(a){w(),J.mouseout(a,d3.event),f.$apply()}).on("mousemove",function(){x(d3.event)}).on("click",function(a){J.click.call(a,d3.event),f.$apply()}),J.labels&&k.selectAll("not-a-class").data(function(a){return a.nicedata}).enter().append("text").attr("x",function(a,c){return b(c)}).attr("y",function(a){return E-Math.abs(c(a.y)-c(0))}).text(function(a){return a.y}),j.append("line").attr("x1",F).attr("y1",c(0)).attr("y2",c(0)).style("stroke","silver")}function r(){function a(a){return Math.round(c(a))+c.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};F-=b.left+b.right,E-=b.top+b.bottom;var c=d3.scale.ordinal().domain(D.map(function(a){return a.x})).rangeRoundBands([0,F]),d=d3.scale.linear().range([E,10]),e=d3.svg.axis().scale(c).orient("bottom");n(e,c);var g=d3.svg.axis().scale(d).orient("left").ticks(5).tickFormat(d3.format("s")),h=d3.svg.line().interpolate("cardinal").x(function(b){return a(b.x)}).y(function(a){return d(a.y)}),i=[0],j=[];D.forEach(function(a){a.y.map(function(a){i.push(a)})});var k=d3.max(D.map(function(a){return a.y.length}));f.yMaxData=k,C.slice(0,k).forEach(function(a,b){var c={};c.series=a,c.values=D.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:D[b].x,y:0}}),j.push(c)});var l=d3.select(G[0]).append("svg").attr("width",F+b.left+b.right).attr("height",E+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),m=.2*d3.max(i);d.domain([d3.min(i),d3.max(i)+m]),l.append("g").attr("class","x axis").attr("transform","translate(0,"+E+")").call(e),l.append("g").attr("class","y axis").call(g);var o=l.selectAll(".points").data(j).enter().append("g");if(path=o.attr("points","points").append("path").attr("class","ac-line").style("stroke",function(a,b){return z(b)}).attr("d",function(a){return h(a.values)}).attr("stroke-width","2").attr("fill","none"),j.length>0){var p=j[j.length-1].values,q=path.node().getTotalLength()+a(p[p.length-1].x);path.attr("stroke-dasharray",q+" "+q).attr("stroke-dashoffset",q).transition().duration(1500).ease("linear").attr("stroke-dashoffset",0).attr("d",function(a){return h(a.values)})}return angular.forEach(j,function(b){var c=l.selectAll(".circle").data(b.values).enter();c.append("circle").attr("cx",function(b){return a(b.x)}).attr("cy",function(a){return d(a.y)}).attr("r",3).style("fill",z(j.indexOf(b))).style("stroke",z(j.indexOf(b))).on("mouseover",function(a){return function(b){v({index:b.x,value:b.y,series:a},d3.event),J.mouseover(b,d3.event),f.$apply()}}(b.series)).on("mouseleave",function(a){w(),J.mouseout(a,d3.event),f.$apply()}).on("mousemove",function(){x(d3.event)}).on("click",function(a){J.click(a,d3.event),f.$apply()}),J.labels&&c.append("text").attr("x",function(b){return a(b.x)}).attr("y",function(a){return d(a.y)}).text(function(a){return a.y})}),"lineEnd"===J.lineLegend&&o.append("text").datum(function(a){return{name:a.series,value:a.values[a.values.length-1]}}).attr("transform",function(b){return"translate("+a(b.value.x)+","+d(b.value.y)+")"}).attr("x",3).text(function(a){return a.name}),j}function s(){function a(a){return Math.round(c(a))+c.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};F-=b.left+b.right,E-=b.top+b.bottom;var c=d3.scale.ordinal().domain(D.map(function(a){return a.x})).rangeRoundBands([0,F]),d=d3.scale.linear().range([E,10]),e=d3.svg.axis().scale(c).orient("bottom");n(e,c);var g=d3.svg.axis().scale(d).orient("left").ticks(5).tickFormat(d3.format("s")),h=(d3.svg.line().interpolate("cardinal").x(function(b){return a(b.x)}).y(function(a){return d(a.y)}),[0]),i=[];D.forEach(function(a){a.y.map(function(a){h.push(a)})});var j=d3.max(D.map(function(a){return a.y.length}));f.yMaxData=j,C.slice(0,j).forEach(function(a,b){var c={};c.series=a,c.values=D.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:D[b].x,y:0}}),i.push(c)});var k=d3.select(G[0]).append("svg").attr("width",F+b.left+b.right).attr("height",E+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),l=.2*d3.max(h);d.domain([d3.min(h),d3.max(h)+l]),k.append("g").attr("class","x axis").attr("transform","translate(0,"+E+")").call(e),k.append("g").attr("class","y axis").call(g);var m=k.selectAll(".points").data(i).enter().append("g"),o=d3.svg.area().interpolate("basis").x(function(b){return a(b.x)}).y0(function(){return d(0)}).y1(function(a){return d(0+a.y)});m.append("path").attr("class","area").attr("d",function(a){return o(a.values)}).style("fill",function(a,b){return z(b)}).style("opacity","0.7")}function t(){function a(a){a.innerRadius=0;var b=d3.interpolate({startAngle:0,endAngle:0},a);return function(a){return g(b(a))}}var b=Math.min(F,E)/2,c=d3.select(G[0]).append("svg").attr("width",F).attr("height",E).append("g").attr("transform","translate("+F/2+","+E/2+")"),d=0;if(J.innerRadius){var e=J.innerRadius;"string"==typeof e&&e.indexOf("%")>0&&(e=b*(1-.01*parseFloat(e))),e&&(d=b-Number(e))}f.yMaxData=D.length;{var g=d3.svg.arc().outerRadius(b-10).innerRadius(d),h=(d3.svg.arc().outerRadius(b+5).innerRadius(0),d3.layout.pie().sort(null).value(function(a){return a.y[0]})),i=c.selectAll(".arc").data(h(D)).enter().append("g");i.append("path").style("fill",function(a,b){return z(b)}).transition().ease("linear").duration(500).attrTween("d",a).attr("class","arc")}i.on("mouseover",function(a){v({value:a.data.y[0]},d3.event),d3.select(this).select("path").transition().duration(200).style("stroke","white").style("stroke-width","2px"),J.mouseover(a,d3.event),f.$apply()}).on("mouseleave",function(a){d3.select(this).select("path").transition().duration(200).style("stroke","").style("stroke-width",""),w(),J.mouseout(a,d3.event),f.$apply()}).on("mousemove",function(){x(d3.event)}).on("click",function(a){J.click(a,d3.event),f.$apply()}),J.labels&&i.append("text").attr("transform",function(a){return"translate("+g.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.y[0]})}function u(){function a(a){return Math.round(c(a))+c.rangeBand()/2}var b={top:0,right:40,bottom:20,left:40};F-=b.left-b.right,E-=b.top-b.bottom;var c=d3.scale.ordinal().domain(D.map(function(a){return a.x})).rangeRoundBands([0,F]),d=d3.scale.linear().range([E,10]),e=d3.svg.axis().scale(c).orient("bottom");n(e,c);var g=d3.svg.axis().scale(d).orient("left").ticks(5).tickFormat(d3.format("s")),h=[0],i=[];D.forEach(function(a){a.y.map(function(a){h.push(a)})});var j=d3.max(D.map(function(a){return a.y.length}));f.yMaxPoints=j,C.slice(0,j).forEach(function(a,b){var c={};c.series=a,c.values=D.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:D[b].x,y:0}}),i.push(c)});var k=d3.select(G[0]).append("svg").attr("width",F+b.left+b.right).attr("height",E+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")"),l=.2*d3.max(h);d.domain([d3.min(h),d3.max(h)+l]),k.append("g").attr("class","x axis").attr("transform","translate(0,"+E+")").call(e),k.append("g").attr("class","y axis").call(g);k.selectAll(".points").data(i).enter().append("g");angular.forEach(i,function(b){var c=k.selectAll(".circle").data(b.values).enter();c.append("circle").attr("cx",function(b){return a(b.x)}).attr("cy",function(a){return d(a.y)}).attr("r",3).style("fill",z(i.indexOf(b))).style("stroke",z(i.indexOf(b))).on("mouseover",function(a){return function(b){v({index:b.x,value:b.y,series:a},d3.event),J.mouseover(b,d3.event),f.$apply()}}(b.series)).on("mouseleave",function(a){w(),J.mouseout(a,d3.event),f.$apply()}).on("mousemove",function(){x(d3.event)}).on("click",function(a){J.click(a,d3.event),f.$apply()}),J.labels&&c.append("text").attr("x",function(b){return a(b.x)}).attr("y",function(a){return d(a.y)}).text(function(a){return a.y})})}function v(a,b){J.tooltips&&(a="[object Function]"==Object.prototype.toString.call(J.tooltips)?J.tooltips(a):a.value,angular.element('<p class="ac-tooltip" style="'+g+'"></p>').html(a).appendTo("body").fadeIn("slow").css({left:b.pageX+20,top:b.pageY-30}))}function w(){angular.element(".ac-tooltip").remove()}function x(a){angular.element(".ac-tooltip").css({left:a.pageX+20,top:a.pageY-30})}function y(){f.legends=[],"pie"==I&&angular.forEach(D,function(a,b){f.legends.push({color:J.colors[b],title:a.x})}),("bar"==I||"area"==I||"point"==I||"hBar"==I||"sBar"==I||"line"==I&&"traditional"===J.lineLegend)&&angular.forEach(C,function(a,b){var c=J.classes[b]+" legend-box";f.legends.push({"class":c,title:a})})}function z(a){if(a<J.colors.length)return J.colors[a];var b=e();return J.colors.push(b),b}function A(a){return a<J.classes.length?J.classes[a]:""}var B,C,D,E,F,G,H,I,J={title:"",tooltips:!0,labels:!1,mouseover:function(){},mouseout:function(){},click:function(){},onload:function(){},drag:function(){},brush:function(){},legend:{display:!0,position:"left"},colors:["steelBlue","rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)"],classes:["set1","set2","set3","set3","set4","set5"],innerRadius:0,lineLegend:"lineEnd",highlight:"#ffa500"},K=h.width(),L=h.height(),M=J.colors;if(0===L||0===K)throw new Error("Please set height and width for the chart element");var N=angular.element(c),O=null;N.bind("resize",function(){O&&d.cancel(O),O=d(function(){K=h.width(),L=h.height(),i()},100)}),f.getWindowDimensions=function(){return{h:N.height(),w:N.width()}},f.$watch("acChart",function(){i()},!0),f.$watch("acData",function(){i()},!0),f.$watch("acConfig",function(){i()},!0)}var g=["display:none;","position:absolute;","border:1px solid #333;","background-color:#161616;","border-radius:5px;","padding:5px;","color:#fff;"].join("");return{restrict:"EA",link:f,transclude:"true",scope:{acChart:"=",acData:"=",acConfig:"="}}}]),angular.module("angularChartsTemplates",["left","right"]),angular.module("left",[]).run(["$templateCache",function(a){a.put("left","\n<style>\n	.axis path,\n	.axis line {\n	  fill: none;\n	  stroke: #333;\n	}\n	.ac-line {\n		fill:none;\n		stroke-width:2px;\n	}\n</style>\n\n<div class='ac-title' style='font-weight: bold;font-size: 1.2em;'>{{acConfig.title}}</div>\n<div class='ac-legend' style='float:left; max-width:25%;' ng-show='{{acConfig.legend.display}}'>\n	<table style='list-style:none;margin:0px;padding:0px;'>\n	<tr ng-repeat=\"l in legends\">\n    <td><div class='{{l.class}}'></div></td>\n		<td style=' display: inline-block;' ng-bind='l.title'></td>\n	</tr>\n	</table>\n</div>\n<div class='ac-chart' style='float:left; width:75%;'>\n</div>\n")}]),angular.module("right",[]).run(["$templateCache",function(a){a.put("right","<style>\n	.axis path,\n	.axis line {\n	  fill: none;\n	  stroke: #333;\n	}\n	.ac-line {\n		fill:none;\n		stroke-width:2px;\n	}\n</style>\n\n<div class='ac-title' style='font-weight: bold;font-size: 1.2em;'>{{acConfig.title}}</div>\n<div class='ac-chart' style='float:left;width:75%;'>\n</div>\n<div class='ac-legend' style='float:left; max-width:25%;' ng-show='{{acConfig.legend.display}}'>\n	<table style='list-style:none;margin:0px;padding:0px;'>\n	<tr ng-repeat=\"l in legends | limitTo:yMaxData\">\n    <td><div class={{l.class}}></div></td>\n		<td style=' display: inline-block;' ng-bind='l.title'></td>\n	</tr>\n	</table>\n</div>\n")}]),angular.module("angularChartsTemplates",["left","right"]),angular.module("left",[]).run(["$templateCache",function(a){a.put("left","\n<style>\n	.axis path,\n	.axis line {\n	  fill: none;\n	  stroke: #333;\n	}\n	.ac-line {\n		fill:none;\n		stroke-width:2px;\n	}\n</style>\n\n<div class='ac-title' style='font-weight: bold;font-size: 1.2em;'>{{acConfig.title}}</div>\n<div class='ac-legend' style='float:left; max-width:25%;' ng-show='{{acConfig.legend.display}}'>\n	<table style='list-style:none;margin:0px;padding:0px;'>\n	<tr ng-repeat=\"l in legends\">\n    <td><div class='{{l.class}}'></div></td>\n		<td style=' display: inline-block;' ng-bind='l.title'></td>\n	</tr>\n	</table>\n</div>\n<div class='ac-chart' style='float:left; width:75%;'>\n</div>\n")}]),angular.module("right",[]).run(["$templateCache",function(a){a.put("right","<style>\n	.axis path,\n	.axis line {\n	  fill: none;\n	  stroke: #333;\n	}\n	.ac-line {\n		fill:none;\n		stroke-width:2px;\n	}\n</style>\n\n<div class='ac-title' style='font-weight: bold;font-size: 1.2em;'>{{acConfig.title}}</div>\n<div class='ac-chart' style='float:left;width:75%;'>\n</div>\n<div class='ac-legend' style='float:left; max-width:25%;' ng-show='{{acConfig.legend.display}}'>\n	<table style='list-style:none;margin:0px;padding:0px;'>\n	<tr ng-repeat=\"l in legends | limitTo:yMaxData\">\n    <td><div class={{l.class}}></div></td>\n		<td style=' display: inline-block;' ng-bind='l.title'></td>\n	</tr>\n	</table>\n</div>\n")}]);